<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZSMS YÃ¶netim Paneli</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Login EkranÄ± -->
  <div id="loginScreen" class="flex flex-col justify-center items-center min-h-screen" style="display:flex;">
    <div class="bg-white p-8 rounded-xl shadow-lg w-80 text-center">
      <h1 class="text-2xl font-bold mb-6 text-gray-700">ğŸ” ZSMS GiriÅŸ</h1>
      <input id="username" placeholder="KullanÄ±cÄ± AdÄ±" class="w-full border p-2 rounded mb-3" />
      <input id="password" type="password" placeholder="Åifre" class="w-full border p-2 rounded mb-4" />
      <button onclick="login()" class="bg-blue-600 text-white w-full py-2 rounded hover:bg-blue-700">GiriÅŸ Yap</button>
      <p id="loginError" class="text-red-500 text-sm mt-3 hidden">âŒ HatalÄ± kullanÄ±cÄ± adÄ± veya ÅŸifre!</p>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="min-h-screen hidden">
    <header class="bg-white shadow p-4 flex justify-between items-center">
      <h1 class="text-xl font-bold text-blue-700">ğŸ“Š ZSMS YÃ¶netim Paneli</h1>
      <button onclick="logout()" class="bg-red-500 text-white px-4 py-1 rounded">Ã‡Ä±kÄ±ÅŸ</button>
    </header>

    <nav class="flex justify-center gap-4 mt-4">
      <button onclick="showTab('gonderilen')" id="tab-gonderilen" class="px-4 py-2 rounded bg-blue-600 text-white">GÃ¶nderilen SMS</button>
      <button onclick="showTab('satin')" id="tab-satin" class="px-4 py-2 rounded bg-white border">SatÄ±n AlÄ±nan SMS</button>
      <button onclick="showTab('rapor')" id="tab-rapor" class="px-4 py-2 rounded bg-white border">Genel Rapor</button>
    </nav>

    <main class="max-w-6xl mx-auto mt-6 p-4">
      <!-- GÃ¶nderilen SMS -->
      <div id="gonderilen" class="bg-white p-6 rounded-xl shadow">
        <h2 class="text-lg font-semibold mb-4">GÃ¶nderilen SMS Ekle</h2>
        <form onsubmit="addRecord(event, 'gonderilen')" class="grid md:grid-cols-3 gap-3">
          <input type="date" id="g-tarih" class="border p-2 rounded" required>
          <select id="g-provider" class="border p-2 rounded">
            <option>SavaÅŸ Sms</option>
            <option>Deniz Sms</option>
            <option>Ã–zer Sms</option>
          </select>
          <input type="number" id="g-sms" placeholder="SMS Adedi" class="border p-2 rounded" required>
          <input id="g-aciklama" placeholder="AÃ§Ä±klama" class="border p-2 rounded md:col-span-2">
          <button type="submit" class="bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Ekle</button>
        </form>
        <h3 class="mt-6 font-semibold">KayÄ±tlar</h3>
        <table id="g-table" class="w-full border text-sm mt-2">
          <thead class="bg-gray-100"><tr><th class="p-2">Tarih</th><th class="p-2">Provider</th><th class="p-2">SMS</th><th class="p-2">AÃ§Ä±klama</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- SatÄ±n AlÄ±nan SMS -->
      <div id="satin" class="bg-white p-6 rounded-xl shadow hidden">
        <h2 class="text-lg font-semibold mb-4">SatÄ±n AlÄ±nan SMS Ekle</h2>
        <form onsubmit="addRecord(event, 'satin')" class="grid md:grid-cols-3 gap-3">
          <input type="date" id="s-tarih" class="border p-2 rounded" required>
          <select id="s-provider" class="border p-2 rounded">
            <option>SavaÅŸ Sms</option>
            <option>Deniz Sms</option>
            <option>Ã–zer Sms</option>
          </select>
          <input type="number" id="s-sms" placeholder="SMS Adedi" class="border p-2 rounded" required>
          <input type="number" id="s-odeme" placeholder="Ã–deme (TL)" class="border p-2 rounded" required>
          <input id="s-aciklama" placeholder="AÃ§Ä±klama" class="border p-2 rounded md:col-span-2">
          <button type="submit" class="bg-blue-600 text-white rounded py-2 hover:bg-blue-700">Ekle</button>
        </form>
        <h3 class="mt-6 font-semibold">KayÄ±tlar</h3>
        <table id="s-table" class="w-full border text-sm mt-2">
          <thead class="bg-gray-100"><tr><th class="p-2">Tarih</th><th class="p-2">Provider</th><th class="p-2">SMS</th><th class="p-2">Ã–deme (TL)</th><th class="p-2">AÃ§Ä±klama</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Rapor -->
      <div id="rapor" class="bg-white p-6 rounded-xl shadow hidden">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">ğŸ“ˆ Genel Rapor</h2>
          <button onclick="downloadCSV()" class="bg-amber-500 text-white px-4 py-2 rounded hover:bg-amber-600">CSV Ä°ndir</button>
        </div>
        <div id="raporSummary" class="grid md:grid-cols-3 gap-4 mb-6"></div>
        <h3 class="font-semibold mb-2">Provider BazlÄ± DaÄŸÄ±lÄ±m</h3>
        <table id="p-table" class="w-full border text-sm mb-6">
          <thead class="bg-gray-100"><tr><th class="p-2">Provider</th><th class="p-2">GÃ¶nderilen</th><th class="p-2">SatÄ±n AlÄ±nan</th><th class="p-2">Toplam</th></tr></thead>
          <tbody></tbody>
        </table>
        <canvas id="pieChart" height="300"></canvas>
      </div>
    </main>
  </div>

  <script>
    const providers = ["SavaÅŸ Sms","Deniz Sms","Ã–zer Sms"];
    let gonderilen = JSON.parse(localStorage.getItem("gonderilen")) || [];
    let satin = JSON.parse(localStorage.getItem("satin")) || [];

    function login(){
      const u=document.getElementById('username').value.trim();
      const p=document.getElementById('password').value.trim();
      if(u==="admin" && p==="zsms123"){
        document.getElementById('loginScreen').style.display='none';
        document.getElementById('dashboard').classList.remove('hidden');
      } else document.getElementById('loginError').classList.remove('hidden');
    }
    function logout(){
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('loginScreen').style.display='flex';
    }

    function showTab(tab){
      document.querySelectorAll('nav button').forEach(b=>b.classList.remove('bg-blue-600','text-white'));
      document.getElementById('tab-'+tab).classList.add('bg-blue-600','text-white');
      ['gonderilen','satin','rapor'].forEach(id=>{
        document.getElementById(id).classList.add('hidden');
      });
      document.getElementById(tab).classList.remove('hidden');
      if(tab==='rapor') renderReport();
    }

    function addRecord(e,type){
      e.preventDefault();
      if(type==='gonderilen'){
        const rec={id:Date.now(),tarih:gTarih.value,provider:gProvider.value,sms:Number(gSms.value),aciklama:gAciklama.value};
        gonderilen.unshift(rec);
        localStorage.setItem('gonderilen',JSON.stringify(gonderilen));
        gTarih.value=''; gSms.value=''; gAciklama.value='';
        renderTable('g');
      }else{
        const rec={id:Date.now(),tarih:sTarih.value,provider:sProvider.value,sms:Number(sSms.value),odeme:Number(sOdeme.value),aciklama:sAciklama.value};
        satin.unshift(rec);
        localStorage.setItem('satin',JSON.stringify(satin));
        sTarih.value=''; sSms.value=''; sOdeme.value=''; sAciklama.value='';
        renderTable('s');
      }
    }

    function renderTable(type){
      const tbody=document.querySelector(`#${type}-table tbody`);
      tbody.innerHTML='';
      (type==='g'?gonderilen:satin).forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML= type==='g'
          ? `<td class='p-2'>${r.tarih}</td><td class='p-2'>${r.provider}</td><td class='p-2'>${r.sms}</td><td class='p-2'>${r.aciklama||''}</td>`
          : `<td class='p-2'>${r.tarih}</td><td class='p-2'>${r.provider}</td><td class='p-2'>${r.sms}</td><td class='p-2'>${r.odeme||0}</td><td class='p-2'>${r.aciklama||''}</td>`;
        tbody.appendChild(tr);
      });
    }

    function renderReport(){
      const totalSent=gonderilen.reduce((a,b)=>a+b.sms,0);
      const totalPurchased=satin.reduce((a,b)=>a+b.sms,0);
      const totalPayment=satin.reduce((a,b)=>a+(b.odeme||0),0);
      document.getElementById('raporSummary').innerHTML=`
        <div class='bg-blue-50 p-4 rounded-lg'><p>GÃ¶nderilen SMS</p><h3 class='text-2xl font-bold text-blue-700'>${totalSent}</h3></div>
        <div class='bg-green-50 p-4 rounded-lg'><p>SatÄ±n AlÄ±nan SMS</p><h3 class='text-2xl font-bold text-green-700'>${totalPurchased}</h3></div>
        <div class='bg-amber-50 p-4 rounded-lg'><p>Toplam Ã–deme</p><h3 class='text-2xl font-bold text-amber-700'>${totalPayment.toFixed(2)} TL</h3></div>
      `;
      const tbody=document.querySelector('#p-table tbody');
      tbody.innerHTML='';
      providers.forEach(p=>{
        const g=gonderilen.filter(x=>x.provider===p).reduce((a,b)=>a+b.sms,0);
        const s=satin.filter(x=>x.provider===p).reduce((a,b)=>a+b.sms,0);
        const tr=document.createElement('tr');
        tr.innerHTML=`<td class='p-2 font-semibold'>${p}</td><td class='p-2'>${g}</td><td class='p-2'>${s}</td><td class='p-2 font-semibold'>${g+s}</td>`;
        tbody.appendChild(tr);
      });
      drawChart(totalSent,totalPurchased);
    }

    function drawChart(sent,purchased){
      const ctx=document.getElementById('pieChart').getContext('2d');
      if(window.pieChart) window.pieChart.destroy();
      window.pieChart=new Chart(ctx,{type:'pie',data:{labels:['GÃ¶nderilen','SatÄ±n AlÄ±nan'],datasets:[{data:[sent,purchased],backgroundColor:['#00C49F','#FF8042']}]},options:{responsive:true}});
    }

    function downloadCSV(){
      const combined=[...gonderilen.map(r=>({...r,type:'GÃ¶nderilen'})),...satin.map(r=>({...r,type:'SatÄ±n AlÄ±nan'}))];
      let csv='Tip,Tarih,Provider,SMS,Ã–deme,AÃ§Ä±klama\\n';
      combined.forEach(r=>{
        csv+=`${r.type},${r.tarih},${r.provider},${r.sms},${r.odeme||''},\"${r.aciklama||''}\"\\n`;
      });
      const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a');
      a.href=url;a.download='ZSMS_Rapor.csv';a.click();URL.revokeObjectURL(url);
    }

    renderTable('g'); renderTable('s');
  </script>
</body>
</html>
